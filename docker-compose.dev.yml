services:
  frontend:
    image: node:22.12.0-alpine        # 팀 공통 Node 버전 고정 (latest 금지)
    working_dir: /app
    ports:
      - "3000:3000"                   # 호스트:컨테이너
    environment:
      - CHOKIDAR_USEPOLLING=true      # Windows 파일 변경 감지 안정화
      - WATCHPACK_POLLING=true        # CRA/Vite 둘 다 도움
      - HOST=0.0.0.0                  # CRA 외부 접속 허용
    volumes:
      - ./frontend:/app               # 코드 동기화
      - node_modules:/app/node_modules # 컨테이너 전용 node_modules (호스트 오염 방지)
    command: sh -lc "if [ ! -d node_modules ] || [ -z \"$(ls -A node_modules 2>/dev/null)\" ]; then npm ci || npm install; fi && npm start"

  #  #백엔드 같이 켜고 싶은 경우 ( 대신 이 경우는 같이
  #  backend:
  #    build: ./backend            # 또는 image: your-backend-image
  #    ports: [ "8080:8080" ]
  #    environment:
  #      - SPRING_PROFILES_ACTIVE=dev
  #    # 필요시 volumes, env 더 추가

volumes:
  node_modules:


# 도커 명령어

# 첫 실행에 의존성 문제 (프론트인경우 up을 했지만 안나오는 경우 run --~~~으로 실행)
# docker compose -f docker-compose.dev.yml run --rm frontend npm install
# docker compose -f docker-compose.dev.yml up

#  :: 프론트만 켜기(백그라운드)
#  docker compose -f docker-compose.dev.yml up -d frontend
#
#  :: 백엔드만 켜기(백그라운드)
#  docker compose -f docker-compose.dev.yml up -d backend
#
#  :: 프론트만 정지
#  docker compose -f docker-compose.dev.yml stop frontend
#
#  :: 백엔드만 정지
#  docker compose -f docker-compose.dev.yml stop backend
#
#  :: 프론트만 재시작
#  docker compose -f docker-compose.dev.yml restart frontend